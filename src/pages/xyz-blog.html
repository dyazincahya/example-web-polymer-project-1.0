<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<link rel="import" href="../shared-styles.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<!--$blogID='2556722185382757751';
$requestURL="http://www.blogger.com/feeds/{$blogID}/posts/default";-->
<dom-module id="xyz-blog">
    <template>
        <style include="shared-styles">
            :host {
                display: block;
                padding: 10px;
            }

            .alt{
                padding-left: 16px;
            }

            h1 a{
                color: #333;
                font-size: 18px;
                text-decoration: none;
            }
        </style>
        <div class="alt">
            <h1><iron-icon icon="icons:bookmark-border"></iron-icon> Latest post &amp; draft</h1>
        </div>
        <template is="dom-repeat" items="[[dataEntry]]">
            <div class="card">
                <h1>
                    <iron-icon icon="[[item.attr.icon]]"></iron-icon>
                    <a href="[[item.url]]" target="[[item.attr.hrefTarget]]">[[item.title]]</a>
                </h1>
                <p>
                    <iron-icon icon="icons:alarm"></iron-icon> [[item.published]]
                    <iron-icon icon="icons:update"></iron-icon> [[item.updated]]
                </p>
            </div>
        </template>
    </template>

    <script>
        Polymer({
            is: 'xyz-blog',
            properties: {
                dataEntry: {
                    type: Array,
                    value: function(){
                        var totalRow = 21,
                            arrContainer = [];

                        for(var i=0; i<=totalRow; i++){
                            arrContainer.push(
                                { 
                                    "title" : '', 
                                    "url"   : '', 
                                    "published" : '', 
                                    "updated" : '',
                                    "attr" : {
                                        "icon" : '', 
                                        "hrefTarget" : ''
                                    }
                                }
                            );
                        }
                        return arrContainer;
                    }
                },
            },
            ready : function(){
                var me = this;
                $.ajax({
                    type: "GET",
                    url: "https://www.blogger.com/feeds/2556722185382757751/posts/default",
                    dataType: "jsonp",
                    success: function(xml) {
                        $(xml).find('entry').each(function(i, e){
                            var title = $(e).find('title').text();
                            var urlPostRaw = $(e).find('link').filter(function( index ) { return index; });
                            var urlPost = $(urlPostRaw).attr("href");
                            var published = $(e).find('published').text();
                            var updated = $(e).find('updated').text();
                            
                            if(urlPostRaw.length == 4){
                                me.set('dataEntry.'+i+'.title', title);
                                me.set('dataEntry.'+i+'.url', urlPost);
                                me.set('dataEntry.'+i+'.published', published);
                                me.set('dataEntry.'+i+'.updated', updated);

                                me.set('dataEntry.'+i+'.attr.icon', "icons:done-all");
                                me.set('dataEntry.'+i+'.attr.hrefTarget', "_blank");
                            }else{
                                me.set('dataEntry.'+i+'.title', title);
                                me.set('dataEntry.'+i+'.url', "#thisDraft");
                                me.set('dataEntry.'+i+'.published', published);
                                me.set('dataEntry.'+i+'.updated', updated);

                                me.set('dataEntry.'+i+'.attr.icon', "icons:lock-outline");
                                me.set('dataEntry.'+i+'.attr.hrefTarget', "_self");
                            }
                        });
                    }
                });
            }
        });
    </script>
</dom-module>
